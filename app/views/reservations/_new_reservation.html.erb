<% title 'Create Reservation' %>

<% unless @errors.empty? %>
  <p>
    <h3>
      <i class="fa fa-exclamation-triangle warning-icon"></i>
      Please be aware of the following errors:
    </h3>
  </p>
  <% @errors.each do |msg| %>
    <ul>
      <li><%= msg %></li>
    </ul>
  <% end %>
<% end %>

<p>
  <h3>Equipment being reserved:</h3>
</p>
<p>
  The following equipment will be reserved by
  <%= link_to User.find(cart.reserver_id).name, User.find(cart.reserver_id),
  target: '_blank' %>
  from
  <%= cart.start_date.to_s(:long) %> to
  <%= cart.due_date.to_s(:long) %>:

</p>

<p>
  <ul class="rounded-list">
    <% cart.items.each do |model_id, quantity| %>
      <li data-value="<%= quantity %>">
        <%= link_to EquipmentModel.find(model_id).name, EquipmentModel.find(model_id) %>
      </li>
    <% end %>
  </ul>
</p>

<!-- edit reservation here -->
<% unless @errors.empty? %>
  <div id="cart" class="well">
    <div id="cartSpinner"></div>
    <header class="cart-header">
       <h2>Reservation Details</h2>
    </header>
    <%# allow user to set start/end dates %>
    <%= render partial: 'reservations/cart_dates' %>
    <h3>Items</h3>
    <%# list items in cart %>
    <%= render partial: 'reservations/list_items_in_cart' %>
    <div id="cart_buttons">
      <%# print Update reservation button %>
      <!-- User should already be logged in so don't need sign in -->
      <%= link_to new_reservation_path, class: 'btn btn-success' do %>
        <%= content_tag :i, nil, class: 'fa fa-shopping-cart' %>
        <%= 'Update Reservation'.titleize %>
      <% end %>
      <%= link_to 'Empty cart'.titleize, url_for(controller: params[:controller], action: 'empty_cart'), method: :delete, class: 'btn btn-default', id: 'empty_cart_btn', remote: true %>
    </div>
  </div>
<% end %>
<!-- end -->

<%= simple_form_for @reservation do |f| %>
  <div class="form-group text<%= ' error' if @notes_required %>">
    <%= f.label :notes, "#{@errors.blank? ? 'Optional notes' : 'Justification for error override'} for this reservation:" %>
    <%= f.input_field :notes, class: 'form-control', rows: 5 %>
  </div>

  <hr>
  <%= f.button :submit, "Finalize Reservation" %>
  <%= link_to "Return to Catalog", catalog_path, class: 'btn btn-default' %>
<% end %>
